<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.animal.api.animal.dao.UserAnimalMapper">
<select id="getAllAnimals" parameterType="Map" resultType="com.animal.api.animal.model.response.AllAnimalListResponseDTO">
SELECT
	A.IDX,
	A.NAME,
	A.GENDER,
	A.AGE,
	A.`SIZE`,
	A.NEUTER,
	A.CREATED_AT,
	AB2.NAME AS 'BREED',
	AB2.ANIMAL_TYPE AS 'TYPE',
	AP.NAME AS 'PERSONALITY',
	AS2.NAME AS 'ADOPTION_STATUS'
FROM
	ANIMALS A
JOIN (
	SELECT
		AB.IDX,
		AB.NAME,
		AT2.NAME AS 'ANIMAL_TYPE'
	FROM
		ANIMAL_BREEDS AB
	JOIN ANIMAL_TYPES AT2
	ON
		AB.ANIMAL_TYPE_IDX = AT2.IDX) AB2
	ON
	A.ANIMAL_BREED_IDX = AB2.IDX
JOIN ANIMAL_PERSONALITIES AP
	ON
	A.ANIMAL_PERSONALITY_IDX = AP.IDX
JOIN ADOPTION_STATUS AS2
	ON
	A.ADOPTION_STATUS_IDX = AS2.IDX
ORDER BY A.IDX DESC
LIMIT ${listSize} OFFSET ${cp}
</select>
<select id="searchAnimals" parameterType="Map" resultType="com.animal.api.animal.model.response.AllAnimalListResponseDTO">
SELECT
	A.IDX,
	A.NAME,
	A.GENDER,
	A.AGE,
	A.`SIZE`,
	A.NEUTER,
	A.CREATED_AT,
	AB2.NAME AS 'BREED',
	AB2.ANIMAL_TYPE AS 'TYPE',
	AP.NAME AS 'PERSONALITY',
	AS2.NAME AS 'ADOPTION_STATUS'
FROM
	ANIMALS A
JOIN (
	SELECT
		AB.IDX,
		AB.NAME,
		AT2.NAME AS 'ANIMAL_TYPE'
	FROM
		ANIMAL_BREEDS AB
	JOIN ANIMAL_TYPES AT2
	ON
		AB.ANIMAL_TYPE_IDX = AT2.IDX) AB2
	ON
	A.ANIMAL_BREED_IDX = AB2.IDX
JOIN ANIMAL_PERSONALITIES AP
	ON
	A.ANIMAL_PERSONALITY_IDX = AP.IDX
JOIN ADOPTION_STATUS AS2
	ON
	A.ADOPTION_STATUS_IDX = AS2.IDX
<where>
	<if test="type != null and type != ''">
		AB2.ANIMAL_TYPE = #{type}
	</if>
	<if test="breed != null and breed != ''">
		AB2.NAME = #{breed}
	</if>
	<if test="gender != null and gender != ''">
		A.GENDER = #{gender}
	</if>
	<if test="neuter != null and neuter != ''">
		A.NEUTER = #{neuter}
	</if>
	<if test="age != null and age != ''">
		A.AGE = #{age}
	</if>
	<if test="adoption_status != null and adoption_status != ''">
		AS2.NAME = #{adoption_status}
	</if>
	<if test="personality != null and personality != ''">
		AP.NAME = #{personality}
	</if>
	<if test="size != null and size != ''">
		A.SIZE = #{size}
	</if>
	<if test="name != null and name != ''">
		A.NAME = #{name}
	</if>
</where>
ORDER BY A.IDX DESC
LIMIT ${listSize} OFFSET ${cp}
</select>
</mapper>