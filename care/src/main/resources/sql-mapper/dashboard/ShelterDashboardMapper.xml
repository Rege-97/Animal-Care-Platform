<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.animal.api.management.dashboard.mapper.ShelterDashboardMapper">
<select id="getVolunteerDashboard" parameterType="int" resultType="com.animal.api.management.dashboard.model.response.SheltervolunteerDashboardResponseDTO">
SELECT
	DATE_FORMAT(VR.CREATED_AT, '%Y-%m') AS 'MONTH',
	COUNT(*) AS 'COUNT'
FROM
	VOLUNTEER_REQUESTS VR
JOIN VOLUNTEERS V 
ON
	VR.VOLUNTEER_IDX = V.IDX
WHERE
	VR.VOLUNTEER_REQUEST_STATUS_IDX = 4
	AND VR.CREATED_AT >= DATE_SUB(CURDATE(), INTERVAL 6 MONTH)
	AND V.USER_IDX = #{idx}
GROUP BY
	DATE_FORMAT(VR.CREATED_AT, '%Y-%m')
ORDER BY
	DATE_FORMAT(VR.CREATED_AT, '%Y-%m') ASC
</select>
</mapper>